---
title: 'Cell Hashing Example'
output: html_document

---

```{r setup}

library(cellhashR)
library(ggplot2)

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=TRUE, error=TRUE)

knitr::opts_knit$set(root.dir = '/Projects/cellhashR')

```

```{r libraryQC}

cellhashR:::PlotLibrarySaturation('./tests/testdata/438-21-GEX')


```


## Basic QC and Filtering on input:

```{r LibraryQC, fig.width=12}

barcodeDir <- './tests/testdata/cellHashing/247-1-hashTagCounts.txt'

barcodeData <- ProcessCountMatrix(rawCountData = barcodeDir, minCountPerCell = 5)
if (nrow(barcodeData) == 0) {
  print('No passing barcodes')
}

if (ncol(barcodeData) == 0) {
  print('No passing cells')
}

```

```{r QC, fig.width=12}

barcodeDir <- '/Projects/cellhashR/tests/testdata/cellHashing/247-1-hashTagCounts.txt'

barcodeData <- ProcessCountMatrix(rawCountData = barcodeDir, minCountPerCell = 5, barcodeWhitelist = c('HTO-1', 'HTO-2', 'HTO-3', 'HTO-4', 'HTO-6'))
if (nrow(barcodeData) == 0) {
  print('No passing barcodes')
}

if (ncol(barcodeData) == 0) {
  print('No passing cells')
}


```

```{r NormalizationQC, fig.width=12}

PlotNormalizationQC(barcodeData)


```

## Generate calls

```{r GenerateCalls, fig.width=12}

barcodeData <- readRDS(file = 'barcodeData.rds')

if (nrow(barcodeData) > 0 && ncol(barcodeData) > 0){
	dt <- GenerateCellHashingCalls(barcodeMatrix = barcodeData, methods = c('multiseq', 'htodemux'))
	
}

```

```{r}

barcodeData <- readRDS(file = 'barcodeData.rds')
cl <- readRDS(file = 'callList.rds')

df <- cellhashR:::ProcessEnsemblHtoCalls(cl, barcodeData)
	


  
```

## Print Session Info

```{r SessionInfo}

sessionInfo()

```

